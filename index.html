<meta charset=utf-8>
<script src='svg.js'></script>
<script>
onload=function(){
  svg=new SVG(300,300);
  svg.trans={x:10,y:10,w:1,h:1};
  svg.lineWidth=0.1;
  var wmin=40;
  var wmax=50;
  var height=80;
  var numsections=8;
  var thickness=3;
  var duktaJoint=0.2;
  var supportLength=1.5*thickness;
  var supportDepth=1*thickness;
  var cutDepth=1*thickness;
  var edgeSupportDepth=1*thickness;

  var sections=[];
  var N=5;
  var wshift=10;
  for(var i=0;i<numsections;i++){
    sections.push(
      [i-0.5,i+0.5].map(function(y){
        return {x: Math.cos(y/(numsections-1)*Math.PI),y:y}
      })
    );
  }
  var sfirst=sections[0][0],slast=sections[numsections-1][0];
  sections = sections.map(function(s){
    return s.map(function(p){
      return {
        x: ((p.x-sfirst.x)/(slast.x-sfirst.x)-0.5)*(wmax-wmin)/2,
        y: (p.y-sfirst.y)/(slast.y-sfirst.y)*height
      }
    });
  })
  sections.forEach(function(s){
    var lines=[];
    for(var i=0;i<=N;i++){
      var cy=(s[0].y+s[1].y)/2
      var line = s.map(function(p){
        return {
          x: (i%2?1:-1)*p.x+(wmin+wmax)/2*i+cy*wshift/height,
          y: p.y
        }
      });
      svg.line(line);
      lines.push(line)
    }
    var first=(s==sections[0]),last=(s==sections[sections.length-1]);
    if(first)svg.line([lines[0][0],lines[lines.length-1][0]]);
    if(last)svg.line([lines[0][1],lines[lines.length-1][1]])
    for(var i=0;i<=N;i++){
      var xsec=lines[i][1].x+wshift/numsections/2;
      var w0=lines[i-1]?(lines[i][1].x-lines[i-1][1].x)*(1-duktaJoint)/2:+wshift/numsections/2;
      var w1=lines[i+1]?(lines[i+1][1].x-lines[i][1].x)*(1-duktaJoint)/2:wshift/numsections/2;
      //section dukta
      if(!last)svg.line([
        {x:xsec-w0,y:lines[i][1].y},
        {x:xsec+w1,y:lines[i][1].y}
      ])
      //center dukta
      if(!first&&!last&&i!=N){
        var cx=(lines[i][1].x+lines[i+1][1].x)/2;
        var cy=(lines[i][0].y+lines[i][1].y)/2;
        var w=(lines[i+1][0].x+lines[i+1][1].x-lines[i][0].x-lines[i][1].x)/2-(supportDepth+supportLength)*2;
        svg.line([
          {x:cx-w*(1-duktaJoint)/2,y:cy},
          {x:cx+w*(1-duktaJoint)/2,y:cy}
        ])
      }

      if(first||last){
        var x=lines[i][0].x;
        var y=(lines[i][0].y+lines[i][1].y)/2;
        var d1=0,d2=0;
        if(i==0||i==N){
          d2=i?-cutDepth:cutDepth;
        }else{
          d1=d2=cutDepth;
        }
        //cut
        svg.line([
          {x:x-d1,y:y-thickness/2},{x:x+d2,y:y-thickness/2},
          {x:x+d2,y:y+thickness/2},{x:x-d1,y:y+thickness/2}
        ],d1&&d2)
        //edgesupport
        var rx=cutDepth+edgeSupportDepth,rw=supportLength;
        var params=[-1,1];
        if(i==0)params=[1];
        if(i==N)params=[-1];
        params.forEach(function(t){
          svg.line([
            {x:x+t*rx,y:y-thickness/2},{x:x+t*(rx+rw),y:y-thickness/2},
            {x:x+t*(rx+rw),y:y+thickness/2},{x:x+t*rx,y:y+thickness/2},
          ],true)
        })
      }
      //support
      if(!first&&!last){
        var x=(lines[i][0].x+lines[i][1].x)/2;
        var y=(lines[i][0].y+lines[i][1].y)/2;
        var lx=(lines[i][1].y-lines[i][0].y)/2;
        var ly=(lines[i][0].x-lines[i][1].x)/2;
        var lr=Math.sqrt(lx*lx+ly*ly);
        lx/=lr;ly/=lr;
        var rx=supportDepth,rw=supportLength,ry=thickness/2;
        var params=[-1,1];
        if(i==0)params=[1];
        if(i==N)params=[-1];
        params.forEach(function(t){
          svg.line([
            {x:x+t*rx*lx-ry*ly,y:y+t*rx*ly+lx*ry},
            {x:x+t*(rx+rw)*lx-ry*ly,y:y+t*(rx+rw)*ly+lx*ry},
            {x:x+t*(rx+rw)*lx+ry*ly,y:y+t*(rx+rw)*ly-lx*ry},
            {x:x+t*rx*lx+ry*ly,y:y+t*rx*ly-lx*ry},
          ],true)
        })
      }
    }
  })






  var img=new Image();
  img.src=svg.toDataURL();
  img.style.border='1px solid red'
  document.body.appendChild(img);
}

</script>